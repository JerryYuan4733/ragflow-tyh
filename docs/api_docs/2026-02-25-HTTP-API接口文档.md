# RAGFlow HTTP API 接口文档

> 文档版本：1.0  
> 最后更新：2026-02-25  
> 基于代码分析：`api/apps/sdk/`  
> 参考：[官方API文档](https://ragflow.io/docs/http_api_reference)

## 1. 概述

### 1.1 基础信息

| 项目 | 说明 |
|------|------|
| 基础URL | `http://{host}:{port}/api/v1` |
| 协议 | HTTP/HTTPS |
| 数据格式 | JSON |
| 字符编码 | UTF-8 |

### 1.2 认证方式

所有API请求需要在Header中携带API Key：

```http
Authorization: Bearer <YOUR_API_KEY>
```

**获取API Key：**
1. 登录RAGFlow Web界面
2. 进入"设置" -> "API管理"
3. 创建新的API Key

### 1.3 响应格式

**成功响应：**
```json
{
  "code": 0,
  "data": { ... },
  "message": ""
}
```

**错误响应：**
```json
{
  "code": 错误码,
  "message": "错误信息",
  "data": null
}
```

### 1.4 错误码说明

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 100 | 参数错误 |
| 101 | 验证失败 |
| 102 | 操作错误 |
| 103 | 数据错误 |
| 104 | 权限错误 |
| 400 | Bad Request |
| 401 | Unauthorized |
| 403 | Forbidden |
| 404 | Not Found |
| 500 | Internal Server Error |

---

## 2. 数据集（Dataset）API

数据集是知识库的容器，用于存储和管理文档。

### 2.1 创建数据集

**POST** `/api/v1/datasets`

创建新的数据集。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `name` | string | 是 | 数据集名称 |
| `avatar` | string | 否 | 头像Base64编码 |
| `description` | string | 否 | 数据集描述 |
| `embedding_model` | string | 否 | Embedding模型名称，默认使用租户默认模型 |
| `permission` | string | 否 | 权限：`me`(私有) / `team`(团队) |
| `chunk_method` | string | 否 | 分块方法，见下表 |
| `parser_config` | object | 否 | 解析器配置 |

**chunk_method 可选值：**

| 值 | 说明 |
|----|------|
| `naive` | 通用解析（默认） |
| `book` | 书籍 |
| `email` | 邮件 |
| `laws` | 法律文档 |
| `manual` | 技术手册 |
| `one` | 整文档单块 |
| `paper` | 学术论文 |
| `picture` | 图片 |
| `presentation` | PPT |
| `qa` | 问答对 |
| `table` | 表格 |
| `tag` | 标签 |

#### 请求示例

```bash
curl -X POST 'http://{address}/api/v1/datasets' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer <YOUR_API_KEY>' \
  -d '{
    "name": "我的知识库",
    "description": "用于产品文档",
    "chunk_method": "naive",
    "parser_config": {
      "chunk_token_num": 256,
      "layout_recognize": true,
      "html4excel": false,
      "raptor": {"use_raptor": false}
    }
  }'
```

#### 响应示例

```json
{
  "code": 0,
  "data": {
    "id": "abc123def456",
    "name": "我的知识库",
    "description": "用于产品文档",
    "embedding_model": "text-embedding-3-small@OpenAI",
    "chunk_method": "naive",
    "permission": "me",
    "chunk_count": 0,
    "document_count": 0,
    "token_count": 0,
    "create_time": 1708849200000,
    "update_time": 1708849200000
  }
}
```

---

### 2.2 获取数据集列表

**GET** `/api/v1/datasets`

获取用户可访问的数据集列表。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `id` | string | 否 | 按ID过滤 |
| `name` | string | 否 | 按名称过滤 |
| `page` | integer | 否 | 页码，默认1 |
| `page_size` | integer | 否 | 每页数量，默认30 |
| `orderby` | string | 否 | 排序字段，默认`create_time` |
| `desc` | boolean | 否 | 降序排列，默认true |

#### 请求示例

```bash
curl -X GET 'http://{address}/api/v1/datasets?page=1&page_size=10' \
  -H 'Authorization: Bearer <YOUR_API_KEY>'
```

#### 响应示例

```json
{
  "code": 0,
  "data": [
    {
      "id": "abc123",
      "name": "产品文档",
      "embedding_model": "text-embedding-3-small@OpenAI",
      "chunk_method": "naive",
      "permission": "me",
      "chunk_count": 1234,
      "document_count": 50,
      "token_count": 500000,
      "create_time": 1708849200000
    }
  ],
  "total": 5
}
```

---

### 2.3 更新数据集

**PUT** `/api/v1/datasets/{dataset_id}`

更新数据集配置。

#### 路径参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `dataset_id` | string | 是 | 数据集ID |

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `name` | string | 否 | 新名称 |
| `description` | string | 否 | 新描述 |
| `embedding_model` | string | 否 | 新Embedding模型（仅在chunk_count=0时可修改） |
| `permission` | string | 否 | 新权限 |
| `chunk_method` | string | 否 | 新分块方法 |
| `parser_config` | object | 否 | 新解析配置 |
| `pagerank` | integer | 否 | PageRank权重（仅Elasticsearch） |

#### 请求示例

```bash
curl -X PUT 'http://{address}/api/v1/datasets/{dataset_id}' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer <YOUR_API_KEY>' \
  -d '{
    "name": "更新后的名称",
    "description": "更新后的描述"
  }'
```

---

### 2.4 删除数据集

**DELETE** `/api/v1/datasets`

删除一个或多个数据集。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `ids` | array/null | 是 | 数据集ID数组，`null`表示删除所有 |

#### 请求示例

```bash
curl -X DELETE 'http://{address}/api/v1/datasets' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer <YOUR_API_KEY>' \
  -d '{
    "ids": ["dataset_id_1", "dataset_id_2"]
  }'
```

---

### 2.5 获取知识图谱

**GET** `/api/v1/datasets/{dataset_id}/knowledge_graph`

获取数据集的知识图谱数据。

#### 响应示例

```json
{
  "code": 0,
  "data": {
    "graph": {
      "nodes": [
        {"id": "node1", "name": "实体1", "pagerank": 0.85},
        {"id": "node2", "name": "实体2", "pagerank": 0.72}
      ],
      "edges": [
        {"source": "node1", "target": "node2", "weight": 0.9}
      ]
    },
    "mind_map": {}
  }
}
```

---

### 2.6 运行GraphRAG

**POST** `/api/v1/datasets/{dataset_id}/run_graphrag`

为数据集运行GraphRAG任务，构建知识图谱。

#### 响应示例

```json
{
  "code": 0,
  "data": {
    "graphrag_task_id": "task_xxx"
  }
}
```

---

### 2.7 运行RAPTOR

**POST** `/api/v1/datasets/{dataset_id}/run_raptor`

为数据集运行RAPTOR任务，构建层次化摘要。

---

## 3. 文档（Document）API

### 3.1 上传文档

**POST** `/api/v1/datasets/{dataset_id}/documents`

上传文档到数据集。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `file` | file | 是 | 上传的文件（multipart/form-data） |

#### 请求示例

```bash
curl -X POST 'http://{address}/api/v1/datasets/{dataset_id}/documents' \
  -H 'Authorization: Bearer <YOUR_API_KEY>' \
  -F 'file=@/path/to/document.pdf'
```

#### 响应示例

```json
{
  "code": 0,
  "data": [
    {
      "id": "doc_xxx",
      "name": "document.pdf",
      "size": 1024000,
      "type": "pdf",
      "status": "0",
      "run": "0",
      "progress": 0,
      "create_time": 1708849200000
    }
  ]
}
```

---

### 3.2 获取文档列表

**GET** `/api/v1/datasets/{dataset_id}/documents`

获取数据集中的文档列表。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `keywords` | string | 否 | 搜索关键词 |
| `page` | integer | 否 | 页码，默认1 |
| `page_size` | integer | 否 | 每页数量，默认30 |
| `orderby` | string | 否 | 排序字段 |
| `desc` | boolean | 否 | 降序排列 |

#### 响应示例

```json
{
  "code": 0,
  "data": {
    "total": 10,
    "docs": [
      {
        "id": "doc_xxx",
        "name": "document.pdf",
        "size": 1024000,
        "type": "pdf",
        "chunk_count": 50,
        "token_count": 10000,
        "progress": 1.0,
        "run": "1",
        "status": "1",
        "create_time": 1708849200000
      }
    ]
  }
}
```

---

### 3.3 更新文档

**PUT** `/api/v1/datasets/{dataset_id}/documents/{document_id}`

更新文档配置。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `name` | string | 否 | 新文件名 |
| `parser_config` | object | 否 | 解析配置 |
| `chunk_method` | string | 否 | 分块方法 |

---

### 3.4 删除文档

**DELETE** `/api/v1/datasets/{dataset_id}/documents`

删除数据集中的文档。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `ids` | array | 是 | 文档ID数组 |

---

### 3.5 解析文档

**POST** `/api/v1/datasets/{dataset_id}/documents/{document_id}/run`

开始解析文档。

#### 请求示例

```bash
curl -X POST 'http://{address}/api/v1/datasets/{dataset_id}/documents/{document_id}/run' \
  -H 'Authorization: Bearer <YOUR_API_KEY>'
```

---

### 3.6 停止解析

**POST** `/api/v1/datasets/{dataset_id}/documents/{document_id}/stop`

停止正在进行的文档解析。

---

### 3.7 下载文档

**GET** `/api/v1/datasets/{dataset_id}/documents/{document_id}`

下载原始文档文件。

---

## 4. 分块（Chunk）API

### 4.1 获取分块列表

**GET** `/api/v1/datasets/{dataset_id}/documents/{document_id}/chunks`

获取文档的分块列表。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `keywords` | string | 否 | 搜索关键词 |
| `page` | integer | 否 | 页码 |
| `page_size` | integer | 否 | 每页数量 |

#### 响应示例

```json
{
  "code": 0,
  "data": {
    "total": 50,
    "chunks": [
      {
        "id": "chunk_xxx",
        "content": "这是分块内容...",
        "important_keywords": ["关键词1", "关键词2"],
        "document_id": "doc_xxx",
        "positions": [[0, 100, 200, 300]],
        "create_time": 1708849200000
      }
    ]
  }
}
```

---

### 4.2 添加分块

**POST** `/api/v1/datasets/{dataset_id}/documents/{document_id}/chunks`

手动添加分块。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `content` | string | 是 | 分块内容 |
| `important_keywords` | array | 否 | 重要关键词 |

---

### 4.3 更新分块

**PUT** `/api/v1/datasets/{dataset_id}/documents/{document_id}/chunks/{chunk_id}`

更新分块内容。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `content` | string | 否 | 新内容 |
| `important_keywords` | array | 否 | 新关键词 |
| `available` | boolean | 否 | 是否可用 |

---

### 4.4 删除分块

**DELETE** `/api/v1/datasets/{dataset_id}/documents/{document_id}/chunks`

删除分块。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `chunk_ids` | array | 是 | 分块ID数组 |

---

### 4.5 检索分块

**POST** `/api/v1/datasets/{dataset_id}/retrieval`

在数据集中检索相关分块。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `question` | string | 是 | 查询问题 |
| `page` | integer | 否 | 页码 |
| `page_size` | integer | 否 | 每页数量 |
| `similarity_threshold` | float | 否 | 相似度阈值 |
| `vector_similarity_weight` | float | 否 | 向量权重 |
| `top_k` | integer | 否 | 返回数量 |
| `rerank_id` | string | 否 | Rerank模型ID |
| `keyword` | boolean | 否 | 是否启用关键词搜索 |
| `highlight` | boolean | 否 | 是否高亮 |

#### 请求示例

```bash
curl -X POST 'http://{address}/api/v1/datasets/{dataset_id}/retrieval' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer <YOUR_API_KEY>' \
  -d '{
    "question": "什么是RAG？",
    "top_k": 10,
    "similarity_threshold": 0.2
  }'
```

#### 响应示例

```json
{
  "code": 0,
  "data": {
    "total": 5,
    "chunks": [
      {
        "id": "chunk_xxx",
        "content": "RAG（Retrieval-Augmented Generation）是一种...",
        "similarity": 0.85,
        "vector_similarity": 0.9,
        "term_similarity": 0.8,
        "document_id": "doc_xxx",
        "document_name": "RAG介绍.pdf",
        "dataset_id": "ds_xxx"
      }
    ]
  }
}
```

---

## 5. Chat助手 API

### 5.1 创建Chat助手

**POST** `/api/v1/chats`

创建新的Chat助手。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `name` | string | 是 | 助手名称 |
| `avatar` | string | 否 | 头像Base64 |
| `dataset_ids` | array | 是 | 关联的数据集ID |
| `llm_id` | string | 否 | LLM模型ID |
| `prompt` | object | 否 | 提示词配置 |
| `llm_setting` | object | 否 | LLM参数设置 |

**prompt 配置结构：**
```json
{
  "system": "你是一个专业的助手...",
  "prologue": "你好！有什么可以帮助你的？",
  "empty_response": "抱歉，没有找到相关信息。",
  "parameters": []
}
```

**llm_setting 配置结构：**
```json
{
  "temperature": 0.1,
  "top_p": 0.3,
  "frequency_penalty": 0.7,
  "presence_penalty": 0.4,
  "max_tokens": 512
}
```

#### 请求示例

```bash
curl -X POST 'http://{address}/api/v1/chats' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer <YOUR_API_KEY>' \
  -d '{
    "name": "产品助手",
    "dataset_ids": ["ds_xxx"],
    "llm_id": "gpt-4o@OpenAI",
    "prompt": {
      "system": "你是产品专家，请根据知识库回答问题。",
      "prologue": "你好！我是产品助手，请问有什么可以帮助你的？"
    }
  }'
```

---

### 5.2 获取Chat助手列表

**GET** `/api/v1/chats`

获取Chat助手列表。

---

### 5.3 更新Chat助手

**PUT** `/api/v1/chats/{chat_id}`

更新Chat助手配置。

---

### 5.4 删除Chat助手

**DELETE** `/api/v1/chats`

删除Chat助手。

---

## 6. 会话（Session）API

### 6.1 创建会话

**POST** `/api/v1/chats/{chat_id}/sessions`

创建新的对话会话。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `name` | string | 否 | 会话名称，默认"New session" |
| `user_id` | string | 否 | 用户标识 |

#### 响应示例

```json
{
  "code": 0,
  "data": {
    "id": "session_xxx",
    "chat_id": "chat_xxx",
    "name": "New session",
    "messages": [
      {"role": "assistant", "content": "你好！有什么可以帮助你的？"}
    ],
    "create_time": 1708849200000
  }
}
```

---

### 6.2 对话补全

**POST** `/api/v1/chats/{chat_id}/completions`

发送消息并获取AI回复。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `question` | string | 是 | 用户问题 |
| `session_id` | string | 否 | 会话ID，不传则创建新会话 |
| `stream` | boolean | 否 | 是否流式响应，默认true |
| `doc_ids` | string | 否 | 限定文档ID，逗号分隔 |

#### 请求示例

```bash
curl -X POST 'http://{address}/api/v1/chats/{chat_id}/completions' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer <YOUR_API_KEY>' \
  -d '{
    "question": "什么是RAGFlow？",
    "stream": true
  }'
```

#### 流式响应示例

```
data: {"code": 0, "data": {"answer": "RAG", "reference": {}}}

data: {"code": 0, "data": {"answer": "Flow是", "reference": {}}}

data: {"code": 0, "data": {"answer": "一个开源的RAG引擎...", "reference": {"chunks": [...]}}}

data: {"code": 0, "data": true}
```

---

### 6.3 OpenAI兼容接口

**POST** `/api/v1/chats_openai/{chat_id}/chat/completions`

OpenAI格式的对话接口，便于与OpenAI SDK集成。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `model` | string | 是 | 模型名称（会被忽略） |
| `messages` | array | 是 | 消息历史 |
| `stream` | boolean | 否 | 流式响应 |
| `extra_body` | object | 否 | 额外参数 |

**extra_body 结构：**
```json
{
  "reference": true,
  "reference_metadata": {
    "include": true,
    "fields": ["author", "year"]
  },
  "metadata_condition": {
    "logic": "and",
    "conditions": [
      {"name": "author", "comparison_operator": "is", "value": "xxx"}
    ]
  }
}
```

#### 请求示例

```bash
curl -X POST 'http://{address}/api/v1/chats_openai/{chat_id}/chat/completions' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer <YOUR_API_KEY>' \
  -d '{
    "model": "model",
    "messages": [
      {"role": "user", "content": "什么是RAGFlow？"}
    ],
    "stream": true
  }'
```

#### 使用OpenAI SDK

```python
from openai import OpenAI

client = OpenAI(
    api_key="<YOUR_API_KEY>",
    base_url="http://{address}/api/v1/chats_openai/{chat_id}"
)

# 流式响应
response = client.chat.completions.create(
    model="model",
    messages=[{"role": "user", "content": "你好"}],
    stream=True
)

for chunk in response:
    print(chunk.choices[0].delta.content, end="")

# 非流式响应
response = client.chat.completions.create(
    model="model", 
    messages=[{"role": "user", "content": "你好"}],
    stream=False
)
print(response.choices[0].message.content)
```

---

## 7. Agent API

### 7.1 获取Agent列表

**GET** `/api/v1/agents`

获取Agent列表。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `page` | integer | 否 | 页码 |
| `page_size` | integer | 否 | 每页数量 |
| `name` | string | 否 | 名称过滤 |

---

### 7.2 获取Agent详情

**GET** `/api/v1/agents/{agent_id}`

获取Agent详细信息。

---

### 7.3 创建Agent会话

**POST** `/api/v1/agents/{agent_id}/sessions`

为Agent创建新会话。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `user_id` | string | 否 | 用户标识 |

---

### 7.4 Agent对话补全

**POST** `/api/v1/agents/{agent_id}/completions`

与Agent进行对话。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `question` | string | 是 | 用户问题 |
| `session_id` | string | 否 | 会话ID |
| `stream` | boolean | 否 | 流式响应 |

---

### 7.5 Agent OpenAI兼容接口

**POST** `/api/v1/agents_openai/{agent_id}/chat/completions`

OpenAI格式的Agent对话接口。

---

## 8. 文件（File）API

### 8.1 上传文件

**POST** `/api/v1/file/upload`

上传文件到文件管理系统。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `file` | file | 是 | 上传的文件 |
| `parent_id` | string | 否 | 父文件夹ID |

---

### 8.2 创建文件/文件夹

**POST** `/api/v1/file/create`

创建文件或文件夹。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `name` | string | 是 | 名称 |
| `type` | string | 是 | 类型：`FOLDER`/`VIRTUAL` |
| `parent_id` | string | 否 | 父文件夹ID |

---

### 8.3 获取文件列表

**GET** `/api/v1/file/list`

获取文件和文件夹列表。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `parent_id` | string | 否 | 父文件夹ID |
| `keywords` | string | 否 | 搜索关键词 |
| `page` | integer | 否 | 页码 |
| `page_size` | integer | 否 | 每页数量 |

---

### 8.4 获取根文件夹

**GET** `/api/v1/file/root_folder`

获取用户的根文件夹信息。

---

### 8.5 删除文件

**POST** `/api/v1/file/rm`

删除文件或文件夹。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `file_ids` | array | 是 | 文件ID数组 |

---

### 8.6 重命名文件

**POST** `/api/v1/file/rename`

重命名文件或文件夹。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `file_id` | string | 是 | 文件ID |
| `name` | string | 是 | 新名称 |

---

### 8.7 下载文件

**GET** `/api/v1/file/get/{file_id}`

下载文件。

---

### 8.8 移动文件

**POST** `/api/v1/file/mv`

移动文件到新位置。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `src_file_ids` | array | 是 | 源文件ID数组 |
| `dest_file_id` | string | 是 | 目标文件夹ID |

---

### 8.9 转换文件为文档

**POST** `/api/v1/file/convert`

将文件转换为文档并关联到数据集。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `file_ids` | array | 是 | 文件ID数组 |
| `kb_ids` | array | 是 | 数据集ID数组 |

---

## 9. 记忆（Memory）API

### 9.1 创建记忆

**POST** `/api/v1/memories`

创建新的记忆空间。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `name` | string | 是 | 记忆名称 |
| `description` | string | 否 | 描述 |
| `memory_type` | integer | 否 | 记忆类型位标志 |
| `storage_type` | string | 否 | 存储类型：`table`/`graph` |
| `embedding_model` | string | 否 | Embedding模型 |
| `llm_id` | string | 否 | LLM模型 |

---

### 9.2 查询记忆

**GET** `/api/v1/memories/{memory_id}/query`

从记忆中检索相关内容。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `query` | string | 是 | 查询文本 |
| `top_k` | integer | 否 | 返回数量 |

---

### 9.3 添加记忆消息

**POST** `/api/v1/memories/{memory_id}/messages`

向记忆中添加消息。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `content` | string | 是 | 消息内容 |
| `role` | string | 否 | 角色：`user`/`assistant` |
| `user_id` | string | 否 | 用户标识 |

---

## 10. 系统API

### 10.1 获取系统版本

**GET** `/api/v1/system/version`

获取RAGFlow版本信息。

---

### 10.2 获取系统状态

**GET** `/api/v1/system/status`

获取系统运行状态。

---

### 10.3 获取LLM厂商列表

**GET** `/api/v1/llm/factories`

获取支持的LLM厂商列表。

---

### 10.4 添加LLM配置

**POST** `/api/v1/llm/add`

添加LLM API配置。

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `llm_factory` | string | 是 | LLM厂商名称 |
| `llm_name` | string | 是 | 模型名称 |
| `api_key` | string | 是 | API密钥 |
| `api_base` | string | 否 | API基础URL |
| `model_type` | string | 否 | 模型类型 |

---

## 附录A：完整API路由清单

### SDK API (`/api/v1/`)

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/datasets` | 创建数据集 |
| GET | `/datasets` | 获取数据集列表 |
| PUT | `/datasets/{id}` | 更新数据集 |
| DELETE | `/datasets` | 删除数据集 |
| GET | `/datasets/{id}/knowledge_graph` | 获取知识图谱 |
| DELETE | `/datasets/{id}/knowledge_graph` | 删除知识图谱 |
| POST | `/datasets/{id}/run_graphrag` | 运行GraphRAG |
| GET | `/datasets/{id}/trace_graphrag` | 追踪GraphRAG进度 |
| POST | `/datasets/{id}/run_raptor` | 运行RAPTOR |
| GET | `/datasets/{id}/trace_raptor` | 追踪RAPTOR进度 |
| POST | `/datasets/{id}/documents` | 上传文档 |
| GET | `/datasets/{id}/documents` | 获取文档列表 |
| PUT | `/datasets/{id}/documents/{doc_id}` | 更新文档 |
| DELETE | `/datasets/{id}/documents` | 删除文档 |
| GET | `/datasets/{id}/documents/{doc_id}` | 下载文档 |
| POST | `/datasets/{id}/documents/{doc_id}/run` | 解析文档 |
| POST | `/datasets/{id}/documents/{doc_id}/stop` | 停止解析 |
| GET | `/datasets/{id}/documents/{doc_id}/chunks` | 获取分块列表 |
| POST | `/datasets/{id}/documents/{doc_id}/chunks` | 添加分块 |
| PUT | `/datasets/{id}/documents/{doc_id}/chunks/{chunk_id}` | 更新分块 |
| DELETE | `/datasets/{id}/documents/{doc_id}/chunks` | 删除分块 |
| POST | `/datasets/{id}/retrieval` | 检索分块 |
| POST | `/chats` | 创建Chat助手 |
| GET | `/chats` | 获取Chat助手列表 |
| PUT | `/chats/{id}` | 更新Chat助手 |
| DELETE | `/chats` | 删除Chat助手 |
| POST | `/chats/{id}/sessions` | 创建会话 |
| GET | `/chats/{id}/sessions` | 获取会话列表 |
| PUT | `/chats/{id}/sessions/{session_id}` | 更新会话 |
| DELETE | `/chats/{id}/sessions` | 删除会话 |
| POST | `/chats/{id}/completions` | 对话补全 |
| POST | `/chats_openai/{id}/chat/completions` | OpenAI兼容接口 |
| GET | `/agents` | 获取Agent列表 |
| GET | `/agents/{id}` | 获取Agent详情 |
| POST | `/agents/{id}/sessions` | 创建Agent会话 |
| POST | `/agents/{id}/completions` | Agent对话 |
| POST | `/agents_openai/{id}/chat/completions` | Agent OpenAI兼容 |
| POST | `/file/upload` | 上传文件 |
| POST | `/file/create` | 创建文件/文件夹 |
| GET | `/file/list` | 获取文件列表 |
| GET | `/file/root_folder` | 获取根文件夹 |
| GET | `/file/parent_folder` | 获取父文件夹 |
| GET | `/file/all_parent_folder` | 获取所有父文件夹 |
| POST | `/file/rm` | 删除文件 |
| POST | `/file/rename` | 重命名文件 |
| GET | `/file/get/{id}` | 下载文件 |
| POST | `/file/mv` | 移动文件 |
| POST | `/file/convert` | 转换文件为文档 |
| POST | `/memories` | 创建记忆 |
| GET | `/memories` | 获取记忆列表 |
| PUT | `/memories/{id}` | 更新记忆 |
| DELETE | `/memories` | 删除记忆 |
| GET | `/memories/{id}/query` | 查询记忆 |
| POST | `/memories/{id}/messages` | 添加记忆消息 |

---

## 附录B：Dify集成API

RAGFlow提供与Dify兼容的检索API。

**POST** `/api/v1/dify/retrieval`

#### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `knowledge_id` | string | 是 | 知识库ID（支持逗号分隔多个） |
| `query` | string | 是 | 查询问题 |
| `retrieval_setting` | object | 否 | 检索设置 |

**retrieval_setting 结构：**
```json
{
  "top_k": 10,
  "score_threshold": 0.5
}
```

---

## 附录C：SDK使用示例

### Python SDK

```python
from ragflow_sdk import RAGFlow

# 初始化客户端
rag = RAGFlow(api_key="<YOUR_API_KEY>", base_url="http://localhost")

# 创建数据集
dataset = rag.create_dataset(name="我的知识库")

# 上传文档
docs = dataset.upload_documents(["/path/to/document.pdf"])

# 解析文档
for doc in docs:
    doc.parse()

# 等待解析完成
import time
for doc in docs:
    while doc.progress < 1.0:
        time.sleep(1)
        doc.refresh()

# 创建Chat助手
chat = rag.create_chat(
    name="助手",
    dataset_ids=[dataset.id]
)

# 对话
session = chat.create_session()
for chunk in session.ask("什么是RAGFlow？"):
    print(chunk.answer, end="")
```
