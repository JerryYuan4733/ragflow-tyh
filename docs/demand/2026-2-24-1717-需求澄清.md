# 需求澄清：2026-2-24 需求文档

**澄清日期**: 2026-02-24  
**澄清对象**: `docs/demand/2026-2-24-demand.md`  
**参照基线**: `tyh-rag-platform/` 现有产品设计V1 + 需求规格V1.1（61条FR） + 架构设计V1.1  
**状态**: ⏳ 待回答

---

## 背景说明

需求文档（2026-2-24-demand.md）提出了企业级RAG系统的整体愿景，涵盖架构分层、RBAC权限、数据隔离、反馈治理、Prompt工程、自动化评估等方面。

同时，同事已在 `tyh-rag-platform/` 目录下实现了一个demo阶段的管理系统，并有完整的产品设计（38功能点）、需求规格（61条FR、10个User Story）、架构设计（DDD四层 + FastAPI + React）、59题澄清文档。

以下澄清问题主要聚焦于 **新需求文档与现有系统之间的冲突点、模糊点和缺失项**。

---

## 澄清问题

### Q1 🔴 RBAC角色体系：6级 vs 3级

| 项目 | 说明 |
|------|------|
| **所在章节** | 第4节 RBAC权限方案 |
| **冲突描述** | 需求文档提出6级角色（Read/Write-Add/Write-Edit/Engineer/Admin/SuperAdmin），但现有系统经59题澄清确认为3级角色（普通用户/知识管理员/IT管理员），已有完整权限矩阵（FR-049）和数据库设计 |
| **影响范围** | 权限系统、数据库表结构、前端路由守卫、API鉴权中间件 |

**请选择或补充**：
- [ ] A) 保持现有3级角色，满足当前企业规模
- [ ] B) 采用新的6级角色，全面重构权限系统
- [ ] C) V1保持3级角色，6级角色作为V2演进路径
- [ ] 其他：____

---

### Q2 🔴 架构定位：BFF层是否已满足

| 项目 | 说明 |
|------|------|
| **所在章节** | 第2.2节 架构分层 |
| **冲突描述** | 需求文档建议"在RAGFlow前面加一层企业网关/BFF"。但现有 `tyh-rag-platform` 的 FastAPI 后端**本质上就是BFF**（自建MySQL管理用户/权限/工单/统计，通过RAGFlow API代理文档/QA/对话）|
| **影响范围** | 整体架构、部署拓扑、开发工作量 |

**请确认**：
- [ ] A) 现有架构（FastAPI作为BFF）已满足，无需额外网关层
- [ ] B) 需要在现有架构之上再加一层独立网关（如Nginx + Auth服务）
- [ ] C) 需要重新设计架构
- [ ] 其他：____

---

### Q3 🟡 三段式Prompt工程：是否在BFF层实现

| 项目 | 说明 |
|------|------|
| **所在章节** | 第6节 提示词模板包（Planner → Answerer → Evaluator）|
| **冲突描述** | 需求文档提出BFF层实现"三段式编排"以复刻网页端体验。但RAGFlow本身已有内置的检索→生成→引用pipeline（`async_chat`），包含rerank、chunk融合等能力 |
| **影响范围** | 对话服务架构、开发复杂度、RAGFlow集成方式 |

**请选择或补充**：
- [ ] A) 完全利用RAGFlow内置pipeline，BFF层只做前后处理（敏感过滤、权限校验、query改写）
- [ ] B) BFF层实现轻量Planner（query改写/多query生成），Answerer和Evaluator仍由RAGFlow+后处理完成
- [ ] C) 完整实现三段式，自行管理检索和生成流程（绕过RAGFlow对话能力）
- [ ] 其他：____

**补充信息**：RAGFlow源码中 `async_chat` 已支持流式输出、引用来源、rerank、metadata过滤等能力。如选C，这些能力需自行实现。

---

### Q4 🟡 数据隔离最终方案

| 项目 | 说明 |
|------|------|
| **所在章节** | 第3节 数据隔离策略 |
| **矛盾点** | 需求文档推荐Silo（每部门独立Dataset），现有系统也用Silo。但早期澄清Q2说"可以创建单独的知识库，也可以使用同一套"，而Q9说"暂不支持跨团队共享" |
| **影响范围** | RAGFlow Dataset管理策略、检索范围控制 |

**请确认**：
- [ ] A) 确认Silo方案：每个团队/部门独立Dataset，不支持跨团队共享
- [ ] B) 混合方案：每部门独立Dataset + 一个公共共享Dataset（如公司通用政策）
- [ ] C) 暂时Silo，后续考虑跨团队共享
- [ ] 其他：____

---

### Q5 🟡 差评治理看板的定位

| 项目 | 说明 |
|------|------|
| **所在章节** | 第5.2节 差评问题治理看板 |
| **疑问** | 需求文档提出"三队列差评治理"（内容缺失队列/检索切分队列/生成幻觉队列），现有系统已有工单管理系统（FR-039~043，待处理→处理中→已解决→已验证）。这是新增独立模块还是对现有系统的增强？|
| **影响范围** | 工单系统扩展、统计分析模块 |

**请选择或补充**：
- [ ] A) 作为工单系统的分类标签增强（给工单增加"根因分类"字段）
- [ ] B) 作为统计分析模块的新看板（基于反馈数据做分类聚合展示）
- [ ] C) 新建独立的"知识治理"模块
- [ ] D) 暂不纳入V1范围
- [ ] 其他：____

---

### Q6 🟡 自动化评估系统

| 项目 | 说明 |
|------|------|
| **所在章节** | 第5.3节 自动化评估 |
| **冲突描述** | 需求文档提出"每部门维护Eval问题集，自动跑命中率/引用覆盖率/拒答率"。但早期Q23确认"先由人工操作"，功能边界明确排除"自动化评分验收系统" |
| **利好信息** | RAGFlow源码中已有 `evaluation_app.py` 和 `EvaluationService`，支持创建评估数据集和测试用例，可复用 |

**请选择或补充**：
- [ ] A) V1维持人工操作，不纳入开发范围
- [ ] B) 利用RAGFlow已有的evaluation能力，做轻量封装（中等工作量）
- [ ] C) 纳入V2迭代计划
- [ ] 其他：____

---

### Q7 🟢 可观测性/追踪

| 项目 | 说明 |
|------|------|
| **所在章节** | 第7.3节 可观测性 |
| **疑问** | 需求文档建议接入Langfuse做tracing。RAGFlow本身有内置可观测能力。是否纳入当前开发范围？|
| **成本评估** | 接入Langfuse需额外部署服务，增加运维复杂度 |

**请选择或补充**：
- [ ] A) 当前不纳入，利用RAGFlow内置日志
- [ ] B) 纳入V1，做基础日志采集和展示（利用现有审计日志模块）
- [ ] C) 纳入V2，完整接入Langfuse
- [ ] 其他：____

---

### Q8 🟢 接口迁移：RAGFlow API选择

| 项目 | 说明 |
|------|------|
| **所在章节** | 第8节 + 文档开头说明 |
| **疑问** | 需要将接口从测试环境(172.30.2.29:80)改为本地RAGFlow。RAGFlow有两套API：① 内部Web API（Cookie认证，`/v1/conversation/completion`）② SDK/Open API（API Key认证，`/api/v1/chats/<chat_id>/completions`，兼容OpenAI格式）|

**请确认**：
- [ ] A) 使用SDK/Open API（推荐，更稳定，适合外部系统集成）
- [ ] B) 使用内部Web API
- [ ] C) 需要先调研现有系统使用的是哪套API再决定
- [ ] 其他：____

---

### Q9 🟢 算法工程师优化赋能的优先级

| 项目 | 说明 |
|------|------|
| **所在章节** | 第8节 最后一段 |
| **疑问** | "作为算法工程师，我可以在哪些地方进行优化赋能？"——需要明确当前迭代中算法优化的具体交付物和优先级 |

**基于RAGFlow源码调研的可赋能方向**：

| 方向 | 说明 | 技术可行性 |
|------|------|------------|
| **检索优化** | query改写、多路召回、rerank模型选择/微调 | RAGFlow支持配置rerank模型，可通过API调参 |
| **切分优化** | 针对业务文档的chunk策略调优 | RAGFlow支持多种parser（naive/book/qa/table等） |
| **Prompt优化** | 系统提示词模板设计和迭代 | 可通过RAGFlow Dialog配置或BFF层注入 |
| **评估体系** | Eval问题集构建、评估pipeline | RAGFlow已有evaluation模块可复用 |
| **敏感过滤** | 内容安全规则引擎 | 现有架构已设计content_filter.py |
| **知识图谱** | RAGFlow内置GraphRAG/MindMap能力 | 源码中有mind_map_extractor，可探索 |

**请标注优先级或补充**：
- 当前迭代重点：____
- 后续迭代方向：____

---

### Q10 🟢 需求文档定位

| 项目 | 说明 |
|------|------|
| **所在章节** | 全文 |
| **疑问** | 此需求文档（2026-2-24）与现有产品设计V1、需求规格V1.1的关系是什么？|

**请选择或补充**：
- [ ] A) 作为补充/演进方向文档，现有V1规格继续作为开发基线
- [ ] B) 替代现有规格，以此文档为新的开发基线
- [ ] C) 提取其中关键增量需求，合并更新到现有V1规格中
- [ ] 其他：____

---

## 快速回答模板

如果您希望快速回答，可以直接用编号+选项的方式，例如：

```
Q1: C
Q2: A
Q3: B
Q4: A
Q5: B
Q6: C
Q7: A
Q8: A
Q9: 当前重点: 检索优化+Prompt优化; 后续: 评估体系+知识图谱
Q10: C
```

也可以在每个问题后面补充说明。
