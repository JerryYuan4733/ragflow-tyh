---
description: ⑦ 自动化测试 - 对生成的 HTML 原型进行浏览器自动化测试
---

## User Input

```text
$ARGUMENTS
```

You **MUST** consider the user input before proceeding (if not empty).

## 流程概述

本工作流使用 **Playwright** 对生成的 HTML 原型进行自动化测试，验证页面渲染和交互功能。

```mermaid
flowchart LR
    A[选择测试目标] --> B[启动本地服务器]
    B --> C[执行自动化测试]
    C --> D[生成测试报告]
    D --> E[关闭服务器]
```

---

## 步骤

### 1. 确认测试目标

**询问用户**（如未在 $ARGUMENTS 中提供）：

| 信息 | 示例 | 必填 |
|------|------|------|
| **迭代名称** | 2026-01-用户管理 | ✅ |
| **测试范围** | 全部 / 指定原型 | 可选 |

**测试范围选项**：
- `全部`：测试该迭代下所有原型
- `指定原型`：只测试指定的原型文件

### 2. 扫描原型文件

扫描 `docs/prototypes/{迭代}/html/` 目录，获取所有原型文件：

```bash
ls docs/prototypes/{迭代}/html/*.html
```

### 3. 启动本地服务器

```bash
python3 -m http.server 8888
```

**工作目录**：`docs/prototypes/`

**等待服务器启动**：2 秒

### 4. 执行自动化测试

对每个原型文件执行以下测试用例：

#### 4.1 页面加载测试

```
使用 mcp1_browser_navigate 打开页面
验证：
- 页面标题不为空
- 页面无 JavaScript 错误
- 页面快照包含预期元素
```

#### 4.2 交互功能测试

根据原型类型执行不同测试：

| 原型类型 | 测试内容 |
|----------|----------|
| 列表页 | 分类切换、搜索、筛选、分页 |
| 表单页 | 输入框填写、表单提交、弹窗显示 |
| 详情页 | Tab 切换、按钮点击、操作响应 |
| 管理页 | 树形结构、CRUD 操作、确认弹窗 |

**测试方法**：

```
1. 使用 mcp1_browser_snapshot 获取页面快照
2. 识别可交互元素（按钮、输入框、链接）
3. 使用 mcp1_browser_click 点击按钮
4. 使用 mcp1_browser_type 输入文本
5. 验证交互后的页面变化（Toast、弹窗、内容更新）
```

#### 4.3 响应式测试（可选）

```
使用 mcp1_browser_resize 调整窗口大小
测试断点：
- 桌面：1200px
- 平板：768px
- 移动：375px
```

### 5. 记录测试结果

对每个测试用例记录：

| 字段 | 说明 |
|------|------|
| 原型名称 | 被测试的原型文件 |
| 测试项 | 具体测试内容 |
| 结果 | ✅ 通过 / ❌ 失败 |
| 说明 | 详细描述或错误信息 |

### 6. 关闭浏览器和服务器

```
使用 mcp1_browser_close 关闭浏览器
停止本地服务器
```

### 7. 输出测试报告

```markdown
# ✅ 自动化测试报告

## 测试概览

| 项目 | 结果 |
|------|------|
| **测试时间** | {日期时间} |
| **测试工具** | Playwright |
| **测试页面** | {N} 个原型 |
| **测试用例** | {N} 个 |
| **通过率** | {X}% |

---

## 测试详情

### 1. {原型名称} {✅/❌}

| 测试项 | 结果 | 说明 |
|--------|------|------|
| 页面加载 | ✅ | {描述} |
| {交互测试1} | ✅ | {描述} |
| {交互测试2} | ✅ | {描述} |

### 2. {原型名称} {✅/❌}

...

---

## 测试结论

**{通过/部分通过/失败}**

{总结说明}

---

## 问题清单（如有失败）

| 原型 | 问题 | 建议 |
|------|------|------|
| {原型名} | {问题描述} | {修复建议} |
```

---

## 测试用例模板

### 列表页测试

```yaml
测试项:
  - 页面加载:
      - 验证标题显示
      - 验证列表数据显示
      - 验证分类/导航显示
  - 分类切换:
      - 点击分类项
      - 验证标题更新
      - 验证 Toast 提示
  - 搜索功能:
      - 输入搜索关键词
      - 按回车或点击搜索
      - 验证响应
  - 新建功能:
      - 点击新建按钮
      - 验证弹窗显示
      - 填写表单
      - 点击提交
      - 验证成功提示
```

### 详情页测试

```yaml
测试项:
  - 页面加载:
      - 验证标题和内容显示
      - 验证 Tab 导航显示
  - Tab 切换:
      - 依次点击每个 Tab
      - 验证内容区域切换
  - 操作按钮:
      - 点击保存/编辑/删除等按钮
      - 验证响应（Toast/弹窗）
```

### 管理页测试

```yaml
测试项:
  - 页面加载:
      - 验证统计卡片显示
      - 验证树形结构显示
      - 验证详情面板显示
  - 树形操作:
      - 点击树节点
      - 验证详情面板更新
  - CRUD 操作:
      - 点击新建按钮，验证弹窗
      - 点击编辑按钮，验证表单
      - 点击删除按钮，验证确认弹窗
```

---

## Key Rules

- **必须启动本地服务器**：Playwright 不支持 file:// 协议
- **使用 MCP Playwright 工具**：mcp1_browser_* 系列工具
- **记录所有测试结果**：无论通过或失败
- **测试后关闭资源**：浏览器和服务器都要关闭
- **不修改原型文件**：测试过程不应修改被测文件

## 使用示例

```bash
# 测试指定迭代的所有原型
/pm.test 2026-01-文档中心

# 测试指定原型
/pm.test 迭代:2026-01-文档中心 原型:首页-文档列表

# 包含响应式测试
/pm.test 2026-01-文档中心 响应式:是
```
